# ü§ñ NevestaAI ‚Äî Telegram-–±–æ—Ç —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π GigaChat

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
**NevestaAI** ‚Äî Telegram-–±–æ—Ç, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π GigaChat API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤.  
–ë–æ—Ç —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –∏–º–µ–µ—Ç —Å—É—Ç–æ—á–Ω—ã–π –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

---

## ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- üí¨ –û–±—â–µ–Ω–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ GigaChat API  
- üß† –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –∏ –ª–∏–º–∏—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏  
- üóìÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞  
- üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ PostgreSQL  
- üîê –ü—Ä–∏–≤—è–∑–∫–∞ –∫ session_id –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
- üßç –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ –∏ –ø—Ä–æ–º–ø—Ç–∞ —á–µ—Ä–µ–∑ –ë–î  
- üß∞ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Docker –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞  

---

## üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
/data/NevestaAI
‚îú‚îÄ‚îÄ app/
‚îÇ ‚îú‚îÄ‚îÄ bot.py # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ Telegram-–±–æ—Ç–∞
‚îÇ ‚îú‚îÄ‚îÄ giga.py # –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å GigaChat API
‚îÇ ‚îú‚îÄ‚îÄ db.py # –†–∞–±–æ—Ç–∞ —Å PostgreSQL
‚îÇ ‚îú‚îÄ‚îÄ cache.py # –ö—ç—à –ª–∏–º–∏—Ç–æ–≤ –∏ –ø—Ä–æ–º–ø—Ç–æ–≤
‚îÇ ‚îú‚îÄ‚îÄ utils.py # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ ‚îú‚îÄ‚îÄ config.py # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ ‚îî‚îÄ‚îÄ .env # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md

yaml
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥

---

## üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `public.nevesta_users`

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-----------|
| `tg_id` | BIGINT | Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `username` | TEXT | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `message_limit` | INTEGER | –¢–µ–∫—É—â–∏–π –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π |
| `last_message_time` | TIMESTAMP | –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ |
| `session_id` | CHAR(36) DEFAULT gen_random_uuid() | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–∏ |

---

### –¢–∞–±–ª–∏—Ü–∞ `public.messages`

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-----------|
| `id` | SERIAL | ID –∑–∞–ø–∏—Å–∏ |
| `tg_id` | BIGINT | Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `role` | TEXT | –†–æ–ª—å (`user` / `bot`) |
| `content` | TEXT | –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è |
| `created_at` | TIMESTAMP | –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ |

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------------|------------|
| `UPDATE_CACHE` | –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—ç—à–∞ –ø—Ä–æ–º–ø—Ç–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö) |
| `PROMPT_NAME` | –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –∏–∑ –ë–î |
| `LIMIT_MESSAGES` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ —Å—É—Ç–∫–∏ |
| `DB_PATH` | –ü—É—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL |
| `GIGACHAT_API_KEY` | –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ –∫ GigaChat API |

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã `.env` —Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**.  
–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:

```bash
cd /data/NevestaAI
docker-compose restart
üßÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏ –∏ –ø—Ä–æ–º–ø—Ç–æ–º
–ò–∑–º–µ–Ω–∏—Ç—å –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sql
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
UPDATE public.nevesta_users
SET message_limit = 50
WHERE tg_id = 123456789;
–û–±–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–∞
sql
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
UPDATE public.nevesta_users
SET last_message_time = NOW()
WHERE tg_id = 123456789;
–ò–∑–º–µ–Ω–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–º–ø—Ç
sql
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
UPDATE public.prompts
SET content = '–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞'
WHERE name = 'main_prompt';
üßπ –†–∞–±–æ—Ç–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ –∫—ç—à–∞
–ü—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ª–∏–º–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ï—Å–ª–∏ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—à–ª–æ –±–æ–ª–µ–µ 24 —á–∞—Å–æ–≤, –ª–∏–º–∏—Ç —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –¥–æ –∑–Ω–∞—á–µ–Ω–∏—è LIMIT_MESSAGES –∏–∑ .env.

–ß—Ç–æ–±—ã –Ω–µ –Ω–∞–≥—Ä—É–∂–∞—Ç—å –ë–î, –ª–∏–º–∏—Ç—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏.

–ï—Å–ª–∏ –ª–∏–º–∏—Ç –∏–∑–º–µ–Ω—ë–Ω –≤—Ä—É—á–Ω—É—é –≤ –ë–î, –±–æ—Ç –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏.

üíæ –†–∞–±–æ—Ç–∞ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±–æ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É messages.
–ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –∫ GigaChat, —á—Ç–æ–±—ã –æ—Ç–≤–µ—Ç—ã –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–º–∏ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏.

üß∞ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Docker
–ö–æ–º–∞–Ω–¥–∞	–û–ø–∏—Å–∞–Ω–∏–µ
docker-compose up -d	–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
docker-compose down	–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
docker-compose restart	–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ (–ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env)
docker logs -f nevestaai	–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

üë®‚Äçüíª –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞, –ª–∏–º–∏—Ç–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –ë–î –∏–ª–∏ .env —Ñ–∞–π–ª.

–ü–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è .env –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
docker-compose restart
–í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL.

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pg_dump.